<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DGem Trading</title>
<style>
body {
  font-family: 'Arial', sans-serif;
  background: linear-gradient(160deg, #0f0c29, #302b63, #24243e);
  color: white;
  text-align: center;
  padding: 30px;
  margin: 0;
}

h1 {
  font-size: 2.2em;
  margin-bottom: 20px;
  letter-spacing: 1px;
  text-shadow: 1px 1px 5px #000;
}

.coin-preview {
  margin: 20px auto;
  width: 150px;
  height: 150px;
  perspective: 800px;
}

.flipping-coin {
  width: 100%;
  height: 100%;
  animation: flip 6s infinite linear;
  transform-style: preserve-3d;
  box-shadow: 0 0 20px rgba(255,153,0,0.7);
  border-radius: 50%;
  border: 3px solid #ff9900;
}

@keyframes flip {
  0% { transform: rotateY(0deg); }
  50% { transform: rotateY(180deg); }
  100% { transform: rotateY(360deg); }
}

.balances {
  display: flex;
  justify-content: center;
  gap: 30px;
  flex-wrap: wrap;
  margin: 20px 0;
}

.balance-card {
  background: rgba(255,255,255,0.1);
  padding: 25px 35px;
  border-radius: 20px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.6);
  min-width: 160px;
  font-size: 1.2em;
  transition: transform 0.3s;
}

.balance-card:hover { transform: translateY(-5px); }

.actions { margin: 20px 0; }

.actions button, .balances button {
  margin: 10px;
  padding: 12px 25px;
  font-size: 1em;
  cursor: pointer;
  border: none;
  border-radius: 15px;
  background: linear-gradient(45deg, #ff9900, #ffcc33);
  color: #000;
  font-weight: bold;
  transition: transform 0.2s, box-shadow 0.2s;
  box-shadow: 0 5px 15px rgba(255,153,0,0.6);
}

.actions button:hover, .balances button:hover {
  transform: scale(1.1);
  box-shadow: 0 8px 20px rgba(255,153,0,0.9);
}

.popup, .transaction-popup {
  position: fixed;
  top: 35%;
  left: 50%;
  transform: translate(-50%, -35%);
  background: #1a1a1a;
  border: 1px solid #ff9900;
  padding: 25px;
  border-radius: 15px;
  z-index: 1000;
  box-shadow: 0 8px 25px rgba(0,0,0,0.9);
  color: white;
  font-weight: bold;
}

.popup button {
  margin: 8px;
  padding: 10px 20px;
  border-radius: 12px;
  border: none;
  background: linear-gradient(45deg, #ff9900, #ffcc33);
  color: #000;
  font-weight: bold;
}

input[type="number"] {
  width: 60px;
  padding: 5px;
  border-radius: 10px;
  border: none;
  font-weight: bold;
  margin-left: 10px;
  text-align: center;
}

#homeBtn {
  margin-top: 20px;
  padding: 10px 20px;
  background: linear-gradient(45deg, #33ccff, #33ffcc);
  border: none;
  border-radius: 12px;
  font-weight: bold;
  cursor: pointer;
  color: #000;
  box-shadow: 0 5px 15px rgba(0,255,255,0.6);
  transition: transform 0.2s;
}

#homeBtn:hover { transform: scale(1.05); }

</style>
</head>
<body>

<h1>DGem Trading Platform</h1>

<div class="coin-preview">
  <img src="dgem.jpg" class="flipping-coin" alt="DGem">
</div>

<div class="balances">
  <div class="balance-card">Coins: <span id="coins">0</span></div>
  <div class="balance-card">DGM: <span id="dgm">0</span></div>
  <div class="balance-card">Price: <span id="price">0</span> coins</div>
</div>

<div class="actions">
  <label>Quantity:
    <input type="number" id="buyQuantity" value="1" min="1">
  </label>
  <button id="buyBtn">Buy DGM</button>
  <button id="updatePriceBtn">Update DGM Price</button>
  <button id="jeeBtn">Solve JEE Question</button>
</div>

<h2 style="margin-top:40px;">Transaction History</h2>
<div id="historyBox" style="
  max-width: 600px;
  margin: 20px auto;
  background: rgba(255,255,255,0.1);
  padding: 20px;
  border-radius: 15px;
  text-align: left;
  box-shadow: 0 10px 25px rgba(0,0,0,0.6);
  max-height: 300px;
  overflow-y: auto;
"></div>

<button id="homeBtn" onclick="location.href='index.html'">Home</button>

<div id="popupContainer"></div>
<div id="transactionPopup" class="transaction-popup" style="display:none;"></div>

<audio id="coinSound" src="coin.mp3"></audio>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, onValue, update, set, push } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyATCUjWe1bbp2yOiZwOzBATrHfU2CE7rPY",
  authDomain: "shushant-3b425.firebaseapp.com",
  projectId: "shushant-3b425",
  storageBucket: "shushant-3b425.firebasestorage.app",
  messagingSenderId: "770199015415",
  appId: "1:770199015415:web:bef917e226d613a469e8f2",
  measurementId: "G-C989SR0F8V"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let coins = 0, dgm = 0, currentPrice = Math.floor(Math.random() * 21 + 10);

const coinsEl = document.getElementById("coins");
const dgmEl = document.getElementById("dgm");
const priceEl = document.getElementById("price");
const coinSound = document.getElementById("coinSound");

const randomPrices = Array.from({length: 10}, () => Math.floor(Math.random() * 21 + 10));

// SAVE TRANSACTION
function saveTransaction(type, qty, price, total) {
  const now = new Date();
  const entry = {
    type,
    quantity: qty,
    price,
    total,
    date: now.toLocaleDateString(),
    time: now.toLocaleTimeString()
  };

  const newRef = push(ref(db, "users/aditya/history"));
  set(newRef, entry);
}

// UI helper
function playSound() { coinSound.currentTime = 0; coinSound.play(); }
function updateUI() { coinsEl.textContent = coins; dgmEl.textContent = dgm; priceEl.textContent = currentPrice; }
function showTransactionPopup(msg) {
  const popup = document.getElementById("transactionPopup");
  popup.style.display = "block"; 
  popup.textContent = msg;
  setTimeout(() => { popup.style.display = "none"; }, 2000);
}

// Firebase Listeners
onValue(ref(db, "users/aditya/balance"), snap => { coins = snap.val() || 0; updateUI(); });
onValue(ref(db, "users/aditya/dgm"), snap => { dgm = snap.val() || 0; updateUI(); });

// BUY
document.getElementById("buyBtn").addEventListener("click", () => {
  const qty = parseInt(document.getElementById("buyQuantity").value) || 1;
  const cost = qty * currentPrice;

  if (coins >= cost) {
    coins -= cost; dgm += qty;
    update(ref(db, "users/aditya"), { balance: coins, dgm });
    showTransactionPopup(`Bought ${qty} DGM for ${cost} coins`);
    saveTransaction("Bought", qty, currentPrice, cost);
    playSound(); updateUI();
  } else alert("Not enough coins!");
});


// UPDATE PRICE
document.getElementById("updatePriceBtn").addEventListener("click", () => {

if (coins < 50) {
  alert("You need at least 10 coins to update the price!");
  return;
}

// Deduct 50 coins
coins -= 10;
update(ref(db, "users/aditya"), { balance: coins });

// Show popup
showTransactionPopup("-10 Coins (Price Update)");

// Save transaction in history
saveTransaction("Price Update Charge", 0, 0, 10);

// Update DGM price
currentPrice = randomPrices[Math.floor(Math.random() * randomPrices.length)];

// Update UI + sound
playSound();
updateUI();
});


// Questions
const sampleQuestions = {
  physics: [
    { question: "A car accelerates from 0 to 20 m/s in 5s. Its acceleration?", options: ["2 m/s²", "4 m/s²", "5 m/s²", "1 m/s²"], answer: "4 m/s²" },
    { question: "Newton's 3rd law explains?", options: ["Inertia", "Force pairs", "Gravity", "Friction"], answer: "Force pairs" },
    { question: "Unit of electric current?", options: ["Volt", "Ampere", "Ohm", "Coulomb"], answer: "Ampere" },
    { question: "Frequency of a wave formula?", options: ["v/λ", "λ/v", "v*λ", "v+λ"], answer: "v/λ" },
    { question: "Gravitational acceleration on Earth?", options: ["9.8 m/s²", "10 m/s²", "8.9 m/s²", "9 m/s²"], answer: "9.8 m/s²" },
    { question: "Energy stored in a capacitor?", options: ["1/2 C V²", "C V²", "1/2 m v²", "m g h"], answer: "1/2 C V²" },
    { question: "Lens formula?", options: ["1/f = 1/v - 1/u", "f = u + v", "v = f - u", "1/f = 1/u + 1/v"], answer: "1/f = 1/u + 1/v" },
    { question: "Unit of pressure?", options: ["Pascal", "Newton", "Joule", "Watt"], answer: "Pascal" },
    { question: "Projectile motion max height?", options: ["u² sin²θ / 2g", "u² cos²θ / 2g", "u² / g", "u² sin2θ / g"], answer: "u² sin²θ / 2g" },
    { question: "SI unit of resistance?", options: ["Ohm", "Volt", "Ampere", "Tesla"], answer: "Ohm" }
  ],

  chemistry: [
    { question: "Molar mass of H2O?", options: ["18 g/mol", "20 g/mol", "16 g/mol", "22 g/mol"], answer: "18 g/mol" },
    { question: "Which is a noble gas?", options: ["Oxygen", "Nitrogen", "Neon", "Hydrogen"], answer: "Neon" },
    { question: "Electrolysis of water produces?", options: ["H2 only", "O2 only", "H2 + O2", "CO2"], answer: "H2 + O2" },
    { question: "pH of neutral solution?", options: ["7", "0", "14", "1"], answer: "7" },
    { question: "Atomic number of Carbon?", options: ["6", "12", "14", "8"], answer: "6" },
    { question: "Most reactive metal?", options: ["Potassium", "Gold", "Iron", "Copper"], answer: "Potassium" },
    { question: "Chemical formula of salt?", options: ["NaCl", "KCl", "CaCl2", "HCl"], answer: "NaCl" },
    { question: "Oxidation state of oxygen in H2O?", options: ["-2", "0", "+1", "+2"], answer: "-2" },
    { question: "Which gas is released in photosynthesis?", options: ["Oxygen", "CO2", "H2", "N2"], answer: "Oxygen" },
    { question: "Avogadro's number?", options: ["6.022×10²³", "3.14", "9.8", "1.6×10⁻¹⁹"], answer: "6.022×10²³" }
  ],

  math: [
    { question: "Derivative of sin(x)?", options: ["cos(x)", "-cos(x)", "sin(x)", "-sin(x)"], answer: "cos(x)" },
    { question: "Integral of 1/x dx?", options: ["ln(x)", "1/x", "x", "e^x"], answer: "ln(x)" },
    { question: "Solve 2x + 3 = 7", options: ["1", "2", "3", "4"], answer: "2" },
    { question: "Limit of (sin x)/x as x→0?", options: ["1", "0", "∞", "-1"], answer: "1" },
    { question: "Derivative of x²?", options: ["2x", "x²", "x", "1"], answer: "2x" },
    { question: "Quadratic equation x² - 5x + 6 = 0, roots?", options: ["2,3", "1,6", "3,2", "0,5"], answer: "2,3" },
    { question: "Value of π (approx)?", options: ["3.1416", "3", "3.15", "3.14"], answer: "3.1416" },
    { question: "Sum of first n natural numbers?", options: ["n(n+1)/2", "n²", "n(n-1)/2", "n+1"], answer: "n(n+1)/2" },
    { question: "Derivative of e^x?", options: ["e^x", "x", "1", "ln(x)"], answer: "e^x" },
    { question: "Integral of x dx?", options: ["x²/2", "x²", "2x", "1/x"], answer: "x²/2" }
  ]
};

function getRandomJEEQuestion() {
  const subs = Object.keys(sampleQuestions);
  const s = subs[Math.floor(Math.random() * subs.length)];
  const q = sampleQuestions[s];
  return q[Math.floor(Math.random() * q.length)];
}

document.getElementById("jeeBtn").addEventListener("click", () => {
  const q = getRandomJEEQuestion();
  const box = document.getElementById("popupContainer");

  box.innerHTML = `
    <div class="popup">
      <h3>${q.question}</h3>
      ${q.options.map(opt => `<button onclick="answer('${opt}','${q.answer}')">${opt}</button>`).join("")}
    </div>
  `;
});

// ANSWER SYSTEM
window.answer = (selected, correct) => {
  document.getElementById("popupContainer").innerHTML = "";

  if (selected === correct) {
    dgm += 1;
    showTransactionPopup("+1 DGM");
    saveTransaction("Answer Correct (+1 DGM)", 1, 0, 0);
  } else {
    dgm -= 4;
    showTransactionPopup("-4 DGM");
    saveTransaction("Answer Wrong (-4 DGM)", 4, 0, 0);
  }

  update(ref(db, "users/aditya"), { dgm });
  playSound();
  updateUI();
};

// LOAD HISTORY
onValue(ref(db, "users/aditya/history"), snap => {
  const box = document.getElementById("historyBox");
  box.innerHTML = "";

  const data = snap.val();
  if (!data) { box.innerHTML = "<p>No transactions yet.</p>"; return; }

  const entries = Object.values(data).reverse();

  entries.forEach(t => {
    box.innerHTML += `
      <div style="margin-bottom:15px; padding:10px; border-bottom:1px solid #ff9900;">
        <strong>${t.type}</strong><br>
        Qty: ${t.quantity}<br>
        Price: ${t.price}<br>
        Total: ${t.total}<br>
        <small>${t.date} • ${t.time}</small>
      </div>
    `;
  });
});

</script>

</body>
</html>
